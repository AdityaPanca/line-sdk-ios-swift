default_platform(:ios)

platform :ios do

  before_all do
    xcversion(version: "10.0")
  end

  desc "Switch to Beta environment"
  lane :to_beta do
    Dir.chdir("../") do
      `git clone https://git.linecorp.com/wei-wang/linesdk-ios-swift-beta-config.git 2> /dev/null || (cd linesdk-ios-swift-beta-config ; git pull)`
    end

    env_path = Pathname.new("../LineSDK/LineSDK/Utils/URLs.swift")
    clone_path = Pathname.new("../linesdk-ios-swift-beta-config/URLs.swift")
    FileUtils.cp(clone_path, env_path)
  end

  desc "Run tests"
  lane :tests do
    run_tests(
        workspace: "LineSDK.xcworkspace",
        devices: ["iPhone 6s"],
        scheme: "LineSDK"
    )
    run_tests(
        workspace: "LineSDK.xcworkspace",
        devices: ["iPhone 6s"],
        scheme: "LineSDKObjC"
    )
    run_tests(
        workspace: "LineSDK.xcworkspace",
        devices: ["iPhone 6s"],
        scheme: "LineSDKSample"
    )
  end

  desc "Generate documentation"
  lane :doc do
    jazzy
  end

  lane :change_log do |options|
    target_version = options[:version]
    raise "The version is missed. You need to specify a version parameter." if target_version.nil?
    stamp_changelog(section_identifier: target_version)
  end

end
